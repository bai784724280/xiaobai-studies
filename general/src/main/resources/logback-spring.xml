<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE configuration>
<configuration>
    <property name="APP_NAME" value="TinkerPlay" />
    <property name="LOG_FILE_PATH" value="${LOG_FILE:-${LOG_PATH:-${LOG_TEMP:-${java.io.tmpdir:-/tmp}}}/logs}"/>
    <springProperty name="MY_IP" source="my.ip"/>
    <springProperty name="MY_PORT" source="my.port"/>

    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d %p (%file:%line\)- %m%n</pattern>
<!--            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %logger{36} - %msg%n</pattern>-->
            <charset>UTF-8</charset>
        </encoder>
    </appender>

    <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <fileNamePattern>./logs/${APP_NAME}/%d/${APP_NAME}-all.%d.%i.log</fileNamePattern>
<!--            <fileNamePattern>${LOG_FILE_PATH}/${APP_NAME}-%d{yyyy-MM-dd}.%i.log</fileNamePattern>-->
            <maxFileSize>1MB</maxFileSize>
            <maxHistory>7</maxHistory>
            <totalSizeCap>10MB</totalSizeCap>
        </rollingPolicy>
        <encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
            <pattern>%date{yyyy-MM-dd HH:mm:ss:SSS}|%-5level|%thread|%method:%line|%logger|%msg%n</pattern>
<!--            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %logger{36} - %msg%n</pattern>-->
            <charset>UTF-8</charset>
        </encoder>
    </appender>

    <appender name="LOGSTASH" class="net.logstash.logback.appender.LogstashTcpSocketAppender">
        <!--可以访问的logstash日志收集端口-->
        <destination>${MY_IP}:${MY_PORT}</destination>
        <encoder charset="UTF-8" class="net.logstash.logback.encoder.LogstashEncoder"/>
    </appender>

    <appender name="ES" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <!-- 日志文件路径 -->
        <file>./logs/${APP_NAME}/es-all.log</file>
        <!-- 滚动策略 -->
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <!-- 滚动文件命名模式 -->
            <fileNamePattern>./logs/${APP_NAME}/es-all.%d{yyyy-MM-dd}.%i.log</fileNamePattern>
            <!-- 单个文件的最大大小 -->
            <maxFileSize>1MB</maxFileSize>
            <!-- 日志保留历史天数 -->
            <maxHistory>7</maxHistory>
            <!-- 总日志大小上限 -->
            <totalSizeCap>10MB</totalSizeCap>
        </rollingPolicy>
        <!-- 文件追加 -->
        <append>true</append>
        <!-- 日志格式 -->
        <encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
            <pattern>
                %date{yyyy-MM-dd HH:mm:ss:SSS}|%-5level|%thread|%method:%line|%logger|%msg%n
            </pattern>
            <charset>UTF-8</charset>
        </encoder>
    </appender>

    <root>
        <level value="INFO" />
        <appender-ref ref="CONSOLE" />
        <appender-ref ref="LOGSTASH"/>
    </root>

    <logger name="com.aiyuns.tinkerplay" level="DEBUG" additivity="true">
        <appender-ref ref="FILE" />
    </logger>
    <logger name="com.aiyuns.tinkerplay.Entity" level="TRACE" additivity="true">
        <appender-ref ref="FILE"/>
    </logger>
    <logger name="org.springframework.data.elasticsearch.client.WIRE" level="TRACE">
        <appender-ref ref="ES"/>
    </logger>>
</configuration>